#!/bin/bash
#

source $STEAMLINK_HOME/setenv.sh

qmake
make $MAKE_J || exit 2

export DESTDIR="${PWD}/steamlink/apps/steamlink-qml-example"

# Copy the files to the app directory
mkdir -p "${DESTDIR}"
cp -v steamlink-qml-example "${DESTDIR}"
cp -r qml "${DESTDIR}"

# Create the table of contents and icon
cat >"${DESTDIR}/toc.txt" <<__EOF__
name=QML Example
icon=icon.png
run=steamlink-qml-example
__EOF__

base64 -d >"${DESTDIR}/icon.png" <<__EOF__
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
Z3uo2QAAAABJRU5ErkJggg==
__EOF__

# All done!
echo "Build complete!"
echo
echo "Put the steamlink folder onto a USB drive, insert it into your Steam Link, and cycle the power to install."
